- content_for :actionbar do
  - if can? :edit, Duty
    %li= link_to "Edit", edit_duty_path(@duty), class: 'btn btn-primary'
  - if can? :delete, Duty
    %li= link_to "Destroy", duty_path(@duty), method: "delete", confirm: 'Are you sure?', class: 'btn btn-danger'
    %li.dropdown
      %a.dropdown-toggle{ href: '#', data: { toggle: "dropdown" } }
        Add Preference
        %strong.caret
      %ul.dropdown-menu
        - @users.each do |user|
          - preference = @duty.preferences.where(user_id: user.id).first
          - if preference.present?
            %li= button_to user.name, preference_path(preference), class: 'btn btn-danger', method: :delete
          - else
            %li= button_to user.name, preferences_path(preference: { duty_id: @duty, user_id: user }), class: 'btn btn-success'
    %li.dropdown
      %a.dropdown-toggle{ href: '#', data: { toggle: "dropdown" } }
        Assign User
        %strong.caret
      %ul.dropdown-menu
        - @users.each do |user|
          - user_ids = [*@duty.users]
          - if user_ids.delete(user)
            %li= button_to user.name, duty_path(@duty, duty: { user_ids: user_ids }), method: :put, class: 'btn btn-danger'
          - else
            - user_ids << user
            %li= button_to user.name, duty_path(@duty, duty: { user_ids: user_ids }), method: :put, class: 'btn btn-success'

.page-header
  %h1= @duty.day_str

%p
  %strong Users
  %br
  = @duty.users.map { |user| user.name }.join(", ")

%p
  %strong Preferences
  %br
  = @duty.preferences.map { |preference| preference.user.name }.join(", ")
